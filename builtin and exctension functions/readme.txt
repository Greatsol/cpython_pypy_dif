В новой ревизии cpython встроенные функции, принимающие целые числа, допускают толькко объекты с методом __index__.
Сделано это чтобы исключить потери данных при неявном преобразовании типа к int посредством метода __int__.

Команды для запуска
Cpython: python3.10 test.py
Pypy: pypy3.9 test.py